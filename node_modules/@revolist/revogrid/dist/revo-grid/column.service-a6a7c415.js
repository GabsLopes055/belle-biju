/*!
 * Built by Revolist OU ❤️
 */
import{a3 as t,a0 as e,a4 as n,Y as s,W as i,w as r,P as o,_ as l,Z as u,a as c,C as f,z as a,b as h}from"./dimension.helpers-d0d709c4.js";import"./index-a61f225b.js";function d(t,e,n,s){var i=-1,r=t==null?0:t.length;if(s&&r){n=t[++i]}while(++i<r){n=e(n,t[i],i,t)}return n}function v(t){return function(e,n,s){var i=-1,r=Object(e),o=s(e),l=o.length;while(l--){var u=o[t?l:++i];if(n(r[u],u,r)===false){break}}return e}}var p=v();const g=p;function y(e,n){return e&&g(e,n,t)}function b(t,n){return function(s,i){if(s==null){return s}if(!e(s)){return t(s,i)}var r=s.length,o=n?r:-1,l=Object(s);while(n?o--:++o<r){if(i(l[o],o,l)===false){break}}return s}}var m=b(y);const j=m;function x(t,e,n,s,i){i(t,(function(t,i,r){n=s?(s=false,t):e(n,t,i,r)}));return n}function O(t,e,i){var r=s(t)?d:x,o=arguments.length<3;return r(t,n(e),i,o,j)}function w(t){if(typeof t==="undefined"||t===null){return""}return t}function R(t,e){if(!e){return}if(e.cellParser){return e.cellParser(t,e)}return t[e.prop]}function C(t,e){return w(R(t,e))}function I(t){if(t.pin){return t.pin}return"rgCol"}function S(t){const e={};for(const[n,s]of t.entries()){if(s.size){e[n]=s.size}}return e}function A(t){return!!t.children}function P(t,e=0,n){const s={columns:{rgCol:[],colPinStart:[],colPinEnd:[]},columnByProp:{},columnGrouping:{rgCol:[],colPinStart:[],colPinEnd:[]},maxLevel:e,sort:{}};return O(t,((t,s)=>{if(A(s)){t=T(t,s,P(s.children,e+1,n),e);return t}const i=s.columnType&&(n===null||n===void 0?void 0:n[s.columnType]);const r=Object.assign(Object.assign({},i),s);if(!r.pin){t.columns.rgCol.push(r)}else{t.columns[r.pin].push(r)}if(r.order){t.sort[r.prop]=r}if(!t.columnByProp[r.prop]){t.columnByProp[r.prop]=[]}t.columnByProp[r.prop].push(r);r.beforeSetup&&r.beforeSetup(r);return t}),s)}function T(t,e,n,i=0){const r=Object.assign(Object.assign({},e),{level:i,ids:[]});for(let e in n.columns){const i=e;const o=t.columns[i];const l=n.columns[i];if(s(o)&&s(l)){o.push(...l);if(l.length){t.columnGrouping[i].push(Object.assign(Object.assign({},r),{ids:l.map((t=>t.prop))}))}}}for(let e in n.columnGrouping){const s=e;const i=n.columnGrouping[s];t.columnGrouping[s].push(...i)}t.maxLevel=Math.max(t.maxLevel,n.maxLevel);t.sort=Object.assign(Object.assign({},t.sort),n.sort);t.columnByProp=Object.assign(Object.assign({},t.columnByProp),n.columnByProp);return t}function M(t,e){for(const n of t){if(A(n)){const t=M(n.children,e);if(t){return t}}else if(n.prop===e){return n}}return undefined}function E(t,e){return M(t,e)}function $(){return{range:null,tempRange:null,tempRangeType:null,focus:null,edit:null,lastCell:null,nextFocus:null}}class F{constructor(){this.unsubscribe=[];this.store=i($());this.store.on("set",((t,e)=>{if(t==="tempRange"&&!e){this.store.set("tempRangeType",null)}}))}onChange(t,e){this.unsubscribe.push(this.store.onChange(t,e))}clearFocus(){r(this.store,{focus:null,range:null,edit:null,tempRange:null})}setFocus(t,e){if(!e){r(this.store,{focus:t})}else{r(this.store,{focus:t,range:J(t,e),edit:null,tempRange:null})}}setNextFocus(t){r(this.store,{nextFocus:t})}setTempArea(t){r(this.store,{tempRange:t===null||t===void 0?void 0:t.area,tempRangeType:t===null||t===void 0?void 0:t.type,edit:null})}clearTemp(){r(this.store,{tempRange:null})}setRangeArea(t){r(this.store,{range:t,edit:null,tempRange:null})}setRange(t,e){const n=J(t,e);this.setRangeArea(n)}setLastCell(t){r(this.store,{lastCell:t})}setEdit(t){const e=this.store.get("focus");if(e&&typeof t==="string"){r(this.store,{edit:{x:e.x,y:e.y,val:t}});return}r(this.store,{edit:null})}dispose(){this.unsubscribe.forEach((t=>t()));this.store.dispose()}}const N=-1;class k{constructor(){this.dirty=false;this.stores={};this.columnStores={};this.rowStores={};this.storesByType={};this.storesXToType={};this.storesYToType={};this.sections=[]}get focusedStore(){var t;for(let e in this.stores){for(let n in this.stores[e]){const s=(t=this.stores[e][n])===null||t===void 0?void 0:t.store.get("focus");if(s){return{entity:this.stores[e][n],cell:s,position:{x:parseInt(n,10),y:parseInt(e,10)}}}}}return null}get edit(){var t;return(t=this.focusedStore)===null||t===void 0?void 0:t.entity.store.get("edit")}get focused(){var t;return(t=this.focusedStore)===null||t===void 0?void 0:t.entity.store.get("focus")}get selectedRange(){var t;return(t=this.focusedStore)===null||t===void 0?void 0:t.entity.store.get("range")}registerSection(t){if(!t){this.sections.length=0;this.dirty=true;return}if(this.sections.indexOf(t)===-1){this.sections.push(t)}}beforeUpdate(){if(this.dirty){for(let t in this.stores){for(let e in this.stores[t]){this.stores[t][e].dispose()}}this.dirty=false}}registerColumn(t,e){if(D(t)){return new F}if(this.columnStores[t]){return this.columnStores[t]}this.columnStores[t]=new F;this.storesByType[e]=t;this.storesXToType[t]=e;return this.columnStores[t]}registerRow(t,e){if(D(t)){return new F}if(this.rowStores[t]){return this.rowStores[t]}this.rowStores[t]=new F;this.storesByType[e]=t;this.storesYToType[t]=e;return this.rowStores[t]}register({x:t,y:e}){var n,s;if(D(t)||D(e)){return new F}if(!this.stores[e]){this.stores[e]={}}if(this.stores[e][t]){return this.stores[e][t]}this.stores[e][t]=new F;(n=this.stores[e][t])===null||n===void 0?void 0:n.onChange("range",(n=>{this.columnStores[t].setRangeArea(n);this.rowStores[e].setRangeArea(n)}));(s=this.stores[e][t])===null||s===void 0?void 0:s.store.on("dispose",(()=>this.destroy(t,e)));return this.stores[e][t]}destroy(t,e){var n,s;(n=this.columnStores[t])===null||n===void 0?void 0:n.dispose();(s=this.rowStores[e])===null||s===void 0?void 0:s.dispose();delete this.rowStores[e];delete this.columnStores[t];if(this.storesXToType[t]){const e=this.storesXToType[t];delete this.storesXToType[t];delete this.storesByType[e]}if(this.storesYToType[e]){const t=this.storesYToType[e];delete this.storesYToType[e];delete this.storesByType[t]}if(this.stores[e]){delete this.stores[e][t]}if(!Object.keys(this.stores[e]||{}).length){delete this.stores[e]}}setEditByCell(t,e){this.focusByCell(t,e,e);this.setEdit("")}beforeNextFocusCell(t){var e;if(!this.focusedStore){return}const n=this.focusedStore.entity.store.get("lastCell");const s=n&&this.getNextStore(t,this.focusedStore.position,n);(e=s===null||s===void 0?void 0:s.store)===null||e===void 0?void 0:e.setNextFocus(Object.assign(Object.assign({},t),s.item))}focusByCell(t,e,n){const s=this.stores[t.y][t.x];this.focus(s,{focus:e,end:n})}focus(t,{focus:e,end:n}){const s=this.getCurrentStorePointer(t);if(!s){return null}const i=t.store.get("lastCell");const r=i&&this.getNextStore(e,s,i);if(r===null||r===void 0?void 0:r.store){const t=Object.assign(Object.assign({},e),r.item);this.focus(r.store,{focus:t,end:t});return null}if(i){e=B(e,i);n=B(n,i)}t.setFocus(e,n);return e}getCurrentStorePointer(t){let e;for(let n in this.stores){for(let s in this.stores[n]){const i=this.stores[n][s];if(i!==t){i.clearFocus()}else{e={x:parseInt(s,10),y:parseInt(n,10)}}}}return e}getNextStore(t,e,n){const s=G(t,n);let i;if(s){Object.entries(s).forEach((([t,n])=>{let r;switch(t){case"x":r=this.getXStores(e.y);break;case"y":r=this.getYStores(e.x);break}if(n>=0){i=r[++e[t]]}else{i=r[--e[t]];const o=i===null||i===void 0?void 0:i.store.get("lastCell");if(o){s[t]=o[t]+n}}}))}return{store:i,item:s}}clearAll(){var t;for(let e in this.stores){for(let n in this.stores[e]){(t=this.stores[e][n])===null||t===void 0?void 0:t.clearFocus()}}}setEdit(t){if(!this.focusedStore){return}this.focusedStore.entity.setEdit(t)}selectAll(){for(let t in this.stores){for(let e in this.stores[t]){const n=this.stores[t][e];if(!n){continue}const s=n.store.get("lastCell");if(s){n.setRange({x:0,y:0},{x:s.x-1,y:s.y-1})}}}}getXStores(t){return this.stores[t]}getYStores(t){const e={};for(let n in this.stores){e[n]=this.stores[n][t]}return e}}function D(t){return t===N}function G(t,e){const n={};let s=["x","y"];for(let e of s){if(t[e]<0){n[e]=t[e];return n}}for(let i of s){if(t[i]>=e[i]){n[i]=t[i]-e[i];return n}}return null}function B(t,e){const n=Object.assign({},t);const s=["x","y"];for(const i of s){if(t[i]<0){n[i]=0}else if(t[i]>=e[i]){n[i]=e[i]-1}}return n}function J(t,e){return t&&e?{x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x1:Math.max(t.x,e.x),y1:Math.max(t.y,e.y)}:null}function z(t){return t.x===t.x1&&t.y===t.y1}const L=`${o}-depth`;const W=`${o}-name`;const Y=`${o}-id`;const q=`${o}-value`;const H=`${o}-column`;const K=`${o}-expanded`;const U=`${o}-prop`;const V=`${o}-original-index`;const X=`group-expand`;const Z="rgRow";function _(t,e){return t[e]||null}function Q(t,e,n=false){let s=0;const i={source:[],prevExpanded:{},oldNewIndexes:{}};e.forEach((e=>{const r=t[e];if(!n){i.source.push(r);return}if(st(r)){if(tt(r)){i.prevExpanded[r[q]]=true}}else{i.source.push(r);i.oldNewIndexes[e]=s;s++}}));return i}function tt(t={}){return t[K]}function et(t,e,{prevExpanded:n,expandedAll:s,getGroupValue:i=_}){const r=new Map;t.forEach(((t,n)=>{const s=e.map((e=>i(t,e)));const o=s.pop();let l=r;s.forEach((t=>{if(!l.has(t)){l.set(t,new Map)}l=l.get(t)}));if(!l.has(o)){l.set(o,[])}const u=l.get(o);u.push(Object.assign(Object.assign({},t),{[V]:n}))}));let o=-1;const l=e.length;const u={};const c={};const f={};const a=[];function h(t,i,r){const l=i.length;t.forEach(((t,d)=>{const v=[...i,d];const p=v.join(",");const g=r&&(!!s||!!(n===null||n===void 0?void 0:n[p]));a.push({[W]:d,[L]:l,[Y]:JSON.stringify(v),[q]:p,[K]:g,[U]:e[l],[e[l]]:d});o+=1;if(!g&&l){u[o]=true}if(Array.isArray(t)){t.forEach((t=>{o+=1;if(!g){u[o]=true}c[t[V]]=o;const e=v.map(((t,e)=>v.slice(0,e+1).join(",")));e.forEach((t=>{if(!f[t]){f[t]=[]}f[t].push(o)}))}));a.push(...t)}else{h(t,v,g)}}))}h(r,[],true);return{sourceWithGroups:a,depth:l,trimmed:u,oldNewIndexMap:c,childrenByGroup:f}}function nt(t){return t&&t[W]}function st(t){return typeof(t===null||t===void 0?void 0:t[W])!=="undefined"}function it(t){return typeof(t===null||t===void 0?void 0:t[H])!=="undefined"}function rt(t,e){const n=t.length;let s=0;for(;s<n;s++){if(t[s]!==e[s]){return s}}return s}function ot(t){const e=JSON.parse(t);if(!Array.isArray(e)){return null}return e}function lt(t,e,n){const s=ot(n[Y]);if(!s){return false}const i=rt(t,s);return e[L]<i}function ut(t,e,n){var s=-1,i=t.length;if(e<0){e=-e>i?0:i+e}n=n>i?i:n;if(n<0){n+=i}i=e>n?0:n-e>>>0;e>>>=0;var r=Array(i);while(++s<i){r[s]=t[s+e]}return r}function ct(t,e,n){var s=t==null?0:t.length;if(!s){return[]}if(n&&typeof n!="number"&&l(t,e,n)){e=0;n=s}else{e=e==null?0:u(e);n=n===undefined?s:u(n)}return ut(t,e,n)}class ft{get columns(){return c(this.source)}constructor(t,e){this.dataStore=t;this.source=e;this.unsubscribe=[];this.hasGrouping=false;this.unsubscribe.push(e.onChange("source",(t=>this.checkGrouping(t))));this.checkGrouping(e.get("source"));this.type=e.get("type")}checkGrouping(t){for(let e of t){if(it(e)){this.hasGrouping=true;return}this.hasGrouping=false}}isReadOnly(t,e){var n;const s=(n=this.columns[e])===null||n===void 0?void 0:n.readonly;if(typeof s==="function"){const n=this.rowDataModel(t,e);return s(n)}return!!s}mergeProperties(t,e,n,s){var i,r;const o=Object.assign({},n);o.class=Object.assign(Object.assign({},typeof o.class==="string"?{[o.class]:true}:o.class),{[f]:true,[a]:this.isReadOnly(t,e)});const l=(r=(i=s.column)===null||i===void 0?void 0:i.cellProperties)===null||r===void 0?void 0:r.call(i,s);if(!l){return o}return dt(o,l)}getRowClass(t,e){const n=h(this.dataStore,t)||{};return n[e]||""}getSaveData(t,e,n){const s=this.rowDataModel(t,e);if(typeof n==="undefined"){n=w(s.value)}return Object.assign(Object.assign({},s),{val:n})}getCellEditor(t,e,n){var s;const i=(s=this.columns[e])===null||s===void 0?void 0:s.editor;if(!i){return undefined}if(typeof i==="string"){return n[i]}return i}rowDataModel(t,e){const n=this.columns[e];const s=n===null||n===void 0?void 0:n.prop;const i=h(this.dataStore,t)||{};const r=this.dataStore.get("type");return{prop:s,model:i,data:this.dataStore.get("source"),column:n,rowIndex:t,colIndex:e,colType:this.type,type:r,value:R(i,n)}}getRangeData(t,e){var n;const s={};const i=t.oldRange.x1-t.oldRange.x+1;const r=t.oldRange.y1-t.oldRange.y+1;const o={};for(let l=t.newRange.y,u=0;l<t.newRange.y1+1;l++,u++){const c=t.oldRange.y+u%r;const f=h(this.dataStore,c)||{};for(let r=t.newRange.x,u=0;r<t.newRange.x1+1;r++,u++){if(l>=t.oldRange.y&&l<=t.oldRange.y1&&r>=t.oldRange.x&&r<=t.oldRange.x1){continue}if(!this.columns[r]){continue}const a=(n=this.columns[r])===null||n===void 0?void 0:n.prop;const h=t.oldRange.x+u%i;const d=e[h].prop;if(!this.isReadOnly(l,r)){if(!s[l]){s[l]={}}s[l][a]=f[d];if(!o[l]){o[l]={}}o[l][a]={colIndex:h,colProp:d,rowIndex:c}}}}return{changed:s,mapping:o}}getTransformedDataToApply(t,e){const n={};const s=e.length;const i=this.columns.length;const r=this.dataStore.get("items").length;let o=t.y;let l=0;for(let u=0;o<r&&u<s;o++,u++){const r=e[u%s];const c=(r===null||r===void 0?void 0:r.length)||0;let f=t.x;for(let t=0;f<i&&t<c;f++,t++){const e=this.columns[f].prop;const s=t%i;if(!this.isReadOnly(o,f)){if(!n[o]){n[o]={}}n[o][e]=r[s]}}l=Math.max(l,f-1)}const u=J(t,{y:o-1,x:l});return{changed:n,range:u}}getRangeStaticData(t,e){const n={};for(let s=t.y,i=0;s<t.y1+1;s++,i++){for(let i=t.x,r=0;i<t.x1+1;i++,r++){if(!this.columns[i]){continue}const t=this.columns[i].prop;if(!this.isReadOnly(s,i)){if(!n[s]){n[s]={}}n[s][t]=e}}}return n}getRangeTransformedToProps(t,e){var n;const s=[];const i=this.dataStore.get("type");for(let r=t.y,o=0;r<t.y1+1;r++,o++){for(let o=t.x,l=0;o<t.x1+1;o++,l++){const t=(n=this.columns[o])===null||n===void 0?void 0:n.prop;s.push({prop:t,rowIndex:r,colIndex:o,model:h(e,r),type:i,colType:this.type})}}return s}copyRangeArray(t,e){const n=[...this.columns];const s=ct(n,t.x,t.x1+1).map((t=>t.prop));const i=[];const r={};for(let n=t.y;n<=t.y1;n++){const t=[];r[n]={};for(let i of s){const s=h(e,n);if(!s){continue}const o=s[i];t.push(o);r[n][i]=o}i.push(t)}return{data:i,mapping:r}}destroy(){this.unsubscribe.forEach((t=>t()))}}function at(t,e){if(typeof t==="function"){return t(e)}return!!t}function ht(t={},e={}){if(typeof t==="string"){t={[t]:true}}if(typeof e==="string"){e={[e]:true}}return Object.assign(Object.assign({},t),e)}function dt(t,e){if(e.className){e.class=ht(e.class,e.className);delete e.className}let n=Object.assign(Object.assign({},e),t);if(e.class){n.class=ht(n.class,e.class)}if(e.style){n.style=Object.assign(Object.assign({},e.style),n.style)}return n}export{q as A,Z as B,H as C,dt as D,N as E,k as F,K as G,ft as H,X as I,W as J,at as K,Y as P,F as S,z as a,Q as b,B as c,tt as d,et as e,nt as f,J as g,st as h,D as i,it as j,ot as k,lt as l,rt as m,G as n,w as o,R as p,C as q,I as r,S as s,A as t,P as u,T as v,E as w,O as x,j as y,L as z};
//# sourceMappingURL=column.service-a6a7c415.js.map